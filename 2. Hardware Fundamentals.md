# Chapter 2: Hardware Fundamentals

In embedded systems, hardware is the foundation upon which everything else is built. Understanding the key components like microcontrollers, sensors, actuators, and power systems is critical for designing robust and efficient embedded systems. This chapter will focus on the hardware fundamentals with a particular emphasis on STM32 microcontrollers.

## 2.1 Microcontrollers and Processors

At the heart of every embedded system is the **microcontroller (MCU)**, a small computer on a single chip that integrates a processor, memory, and input/output peripherals. STM32 microcontrollers, developed by STMicroelectronics, are widely used in embedded systems due to their performance, scalability, and rich peripheral sets.

### STM32 Microcontroller Architecture
STM32 microcontrollers are primarily based on the **ARM Cortex-M** architecture. These microcontrollers are designed for efficiency and real-time performance, offering a balance between power consumption and processing capabilities.

#### Key Features of STM32 Microcontrollers:
- **Cortex-M Cores**: Most STM32 chips use ARM Cortex-M cores, which range from Cortex-M0 (ultra-low-power) to Cortex-M7 (high-performance).
- **Cortex-A Cores**: With the introduction of the STM32MP1 series, STMicroelectronics has expanded its offering to include Cortex-A cores, providing application processor capabilities for more demanding applications.
- **Integrated Peripherals**: STM32 offers a wide range of peripherals such as **UART**, **SPI**, **I2C**, **ADC**, **PWM**, and **DMA** to interface with external components.
- **Memory**: Flash memory for code storage and SRAM for data storage are integrated into the chip.
- **Clocking System**: Flexible clock configurations to adjust power and performance trade-offs, including **low-power modes** and **high-speed external clocks**.
- **Real-time Processing**: STM32 is designed to handle real-time tasks with minimal latency, making it suitable for time-critical applications.
  
### Microcontroller Selection
When selecting a microcontroller, key considerations include:
- **Processing Power**: Choose a core based on required performance (Cortex-M0 for low-power, Cortex-M4/M7 for high-performance).
- **Memory Requirements**: Determine the amount of flash and SRAM based on the complexity of the application.
- **Peripheral Requirements**: Identify the types and numbers of peripherals needed for your project (e.g., UART, SPI, I2C).
- **Power Consumption**: Select an STM32 family with power-saving features if energy efficiency is a concern.

---

## 2.2 Sensors and Actuators

Sensors and actuators form the interface between the embedded system and the real world. The microcontroller processes the data from sensors and sends commands to actuators to control devices.

### Sensors
A **sensor** is a device that detects physical phenomena such as temperature, light, motion, or pressure, and converts it into an electrical signal that can be processed by the microcontroller.

#### Common Sensors in STM32 Projects:
- **Temperature Sensors**: Measure heat (e.g., **LM35**, **NTC thermistors**).
- **Light Sensors**: Detect light levels, such as photoresistors or digital light sensors like the **TSL2561**.
- **Motion Sensors**: Devices like **accelerometers** (e.g., **MPU6050**) and **gyroscopes** detect movement or orientation.
- **Proximity Sensors**: Use infrared or ultrasound to detect nearby objects.

#### Interfacing Sensors with STM32
Sensors can be interfaced with STM32 via several communication protocols:
- **Analog Sensors**: Use **ADC (Analog-to-Digital Converter)** to read values from sensors that provide analog output.
- **Digital Sensors**: Communicate over protocols like **I2C**, **SPI**, or **UART** for more complex sensors.

### Actuators
An **actuator** converts electrical signals into physical action, allowing the embedded system to interact with the environment.

#### Common Actuators in STM32 Projects:
- **DC Motors**: Control rotational movement; used in robotics and industrial machines.
- **Servo Motors**: Provide precise control of angular positions.
- **Relays**: Electrically operated switches that control high-power devices like lights, fans, or industrial machinery.
- **LEDs and Displays**: Visual indicators like LEDs or more complex OLED/SSD1306 displays are actuated to provide feedback.

#### Interfacing Actuators with STM32
- **PWM (Pulse Width Modulation)**: Commonly used to control the speed of motors or the brightness of LEDs.
- **GPIO**: General-purpose input/output pins are often used to trigger relays or drive simple actuators.

---

## 2.3 Power Systems and Management

Power is the lifeblood of any embedded system. STM32 microcontrollers can be powered in various ways, and managing power efficiently is crucial, especially in battery-powered or energy-sensitive applications.

### Power Sources
- **Battery Power**: STM32 can run on batteries (e.g., **Li-Po**, **AA/AAA cells**), often using **buck/boost converters** to supply the correct voltage.
- **USB Power**: For small devices, USB provides a convenient power source, especially during development.
- **External Power Supplies**: AC/DC adapters or regulated power supplies can be used in larger or industrial systems.

### Power Conversion and Regulation
Power supplies must be conditioned to provide a stable voltage to the STM32 microcontroller and peripherals. Common methods include:
- **Voltage Regulators**: Linear regulators like the **7805** or low-dropout regulators (LDOs) provide stable voltage output.
- **Switching Regulators (DC/DC Converters)**: Provide higher efficiency by stepping voltage up (boost) or down (buck) without wasting energy as heat.
- **Battery Chargers**: In battery-powered systems, a charging circuit is required to manage the power input and ensure the battery is properly charged and protected.

### Power Management in STM32
STM32 microcontrollers offer advanced power management features, including:
- **Low-power Modes**: STM32 supports multiple low-power modes (e.g., **Sleep**, **Stop**, and **Standby**) that reduce energy consumption when full processing power isn’t needed.
- **Dynamic Voltage and Frequency Scaling (DVFS)**: Allows the microcontroller to adjust its clock speed and power consumption dynamically based on the workload.
- **Battery Monitoring**: Built-in **ADC** can be used to monitor battery voltage and adjust the system's behavior accordingly.

---

## Conclusion

In this chapter, we covered the essential hardware elements of an embedded system, focusing on STM32 microcontrollers. Understanding how to choose the right microcontroller, interface with sensors and actuators, and manage power efficiently is fundamental for developing robust embedded systems. With STM32’s rich set of peripherals, advanced power management features, and flexible architecture, it provides a powerful platform for a wide range of embedded applications.
